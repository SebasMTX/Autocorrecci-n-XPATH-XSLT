var formElement=null;var respuestaText=null;var respuestaText2=null;var respuestaSelect=null;var respuestaSelect2=null;var respuestasCheckbox=[];var respuestasCheckbox2=[];var respuestasMultiple=[];var respuestasMultiple2=[];var respuestasRadio=[];var respuestasRadio2=[];var xmlDoc=null;var xslDoc=null;var nota=0.0;window.onload=function(){formElement=document.getElementById('myform');formElement.onsubmit=function(){if(comprobar()){corregirTexto();corregirTexto2();corregirSelect();corregirSelect2();corregirCheckbox();corregirCheckbox2();corregirMultiple();corregirMultiple2();corregirRadio();corregirRadio2();presentarNota();} return false;} var xhttp=new XMLHttpRequest();xhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){gestionarXml(this);}};xhttp.open("GET","xml/questions.xml",true);xhttp.send();var xhttp2=new XMLHttpRequest();xhttp2.onreadystatechange=function(){if(this.readyState==4&&this.status==200){xslDoc=this.responseXML;}};xhttp2.open("GET","xml/questions.xsl",true);xhttp2.send();} function gestionarXml(dadesXml){xmlDoc=dadesXml.responseXML;var tituloInput=xmlDoc.getElementsByTagName("title")[0].innerHTML;ponerDatosInputHtml(tituloInput);respuestaText=parseInt(xmlDoc.getElementsByTagName("answer")[0].innerHTML);var tituloSelect=xmlDoc.getElementsByTagName("title")[1].innerHTML;var xpath="/questions/question[@id='p002']/option";var nodesSelect=xmlDoc.evaluate(xpath,xmlDoc,null,XPathResult.ANY_TYPE,null);ponerDatosSelectHtml(tituloSelect,nodesSelect);respuestaSelect=parseInt(xmlDoc.getElementsByTagName("answer")[0].innerHTML);var tituloCheckbox=xmlDoc.getElementsByTagName("title")[2].innerHTML;var xpath="/questions/question[@id='p003']/option";var nodesCheckbox=xmlDoc.evaluate(xpath,xmlDoc,null,XPathResult.ANY_TYPE,null);ponerDatosCheckboxHtml(tituloCheckbox,nodesCheckbox);var nres=xmlDoc.getElementById("p003").getElementsByTagName('answer').length;for(i=0;i<nres;i++){respuestasCheckbox[i]=xmlDoc.getElementById("p003").getElementsByTagName("answer")[i].innerHTML;} var tituloMultiple=xmlDoc.getElementsByTagName("title")[3].innerHTML;var xpath="/questions/question[@id='p004']/option";var nodesMultiple=xmlDoc.evaluate(xpath,xmlDoc,null,XPathResult.ANY_TYPE,null);ponerDatosMultipleHtml(tituloMultiple,nodesMultiple);var nresMS=xmlDoc.getElementById("p004").getElementsByTagName('answer').length;for(i=0;i<nresMS;i++){respuestasMultiple[i]=xmlDoc.getElementById("p004").getElementsByTagName("answer")[i].innerHTML;} var tituloRadio=xmlDoc.getElementsByTagName("title")[4].innerHTML;var xpath="/questions/question[@id='p005']/option";var nodesRadio=xmlDoc.evaluate(xpath,xmlDoc,null,XPathResult.ANY_TYPE,null);ponerDatosradio(tituloRadio,nodesRadio);var nres=xmlDoc.getElementById("p005").getElementsByTagName('answer').length;for(i=0;i<nres;i++){respuestasRadio[i]=xmlDoc.getElementById("p005").getElementsByTagName("answer")[0].innerHTML;} var tituloInput2=xmlDoc.getElementsByTagName("title")[5].innerHTML;ponerDatosInputHtml2(tituloInput2);respuestaText2=parseInt(xmlDoc.getElementsByTagName("answer")[0].innerHTML);var tituloSelect2=xmlDoc.getElementsByTagName("title")[6].innerHTML;var xpath="/questions/question[@id='p007']/option";var nodesSelect2=xmlDoc.evaluate(xpath,xmlDoc,null,XPathResult.ANY_TYPE,null);ponerDatosSelectHtml2(tituloSelect2,nodesSelect2);respuestaSelect2=parseInt(xmlDoc.getElementsByTagName("answer")[0].innerHTML);var tituloCheckbox2=xmlDoc.getElementsByTagName("title")[7].innerHTML;var xpath="/questions/question[@id='p008']/option";var nodesCheckbox2=xmlDoc.evaluate(xpath,xmlDoc,null,XPathResult.ANY_TYPE,null);ponerDatosCheckboxHtml2(tituloCheckbox2,nodesCheckbox2);var nres=xmlDoc.getElementById("p008").getElementsByTagName('answer').length;for(i=0;i<nres;i++){respuestasCheckbox2[i]=xmlDoc.getElementById("p008").getElementsByTagName("answer")[i].innerHTML;} var tituloMultiple2=xmlDoc.getElementsByTagName("title")[8].innerHTML;var xpath="/questions/question[@id='p009']/option";var nodesMultiple2=xmlDoc.evaluate(xpath,xmlDoc,null,XPathResult.ANY_TYPE,null);ponerDatosMultipleHtml2(tituloMultiple2,nodesMultiple2);var nresMS2=xmlDoc.getElementById("p009").getElementsByTagName('answer').length;for(i=0;i<nresMS2;i++){respuestasMultiple2[i]=xmlDoc.getElementById("p009").getElementsByTagName("answer")[i].innerHTML;} var tituloRadio2=xmlDoc.getElementsByTagName("title")[9].innerHTML;var xpath="/questions/question[@id='p010']/option";var nodesRadio2=xmlDoc.evaluate(xpath,xmlDoc,null,XPathResult.ANY_TYPE,null);ponerDatosradio2(tituloRadio2,nodesRadio2);var nres=xmlDoc.getElementById("p010").getElementsByTagName('answer').length;for(i=0;i<nres;i++){respuestasRadio2[i]=xmlDoc.getElementById("p010").getElementsByTagName("answer")[0].innerHTML;}} function corregirTexto(){var s=formElement.elements[0].value;if(s==respuestaText){darRespuestaHtml("P1: Exacto!");nota+=1;} else darRespuestaHtml("P1: Respuesta equivocada");var useranswer=xmlDoc.createElement("useranswer");useranswer.innerHTML=s;xmlDoc.getElementById("p001").appendChild(useranswer);} function corregirSelect(){var sel=formElement.elements[1];if(sel.selectedIndex==respuestaSelect){darRespuestaHtml("P2: Correcto");nota+=1;} else darRespuestaHtml("P2: Incorrecto");var useranswer=xmlDoc.createElement("useranswer");useranswer.innerHTML=sel.selectedIndex;xmlDoc.getElementById("p002").appendChild(useranswer);} function corregirCheckbox(){var f=formElement;var escorrecta=[];for(i=0;i<f.color.length;i++){if(f.color[i].checked){var useranswer=xmlDoc.createElement("useranswer");useranswer.innerHTML=i+1;xmlDoc.getElementById("p003").appendChild(useranswer);escorrecta[i]=false;for(j=0;j<respuestasCheckbox.length;j++){if(i==respuestasCheckbox[j])escorrecta[i]=true;} if(escorrecta[i]){nota+=1.0/respuestasCheckbox.length;darRespuestaHtml("P3: "+i+" correcta");}else{nota-=1.0/respuestasCheckbox.length;darRespuestaHtml("P3: "+i+" incorrecta");}}}} function corregirMultiple(){var mySel=formElement.elements[2];if(mySel.selectedIndex==respuestasMultiple){darRespuestaHtml("P4: Correcto");nota+=1;} else darRespuestaHtml("P4: Incorrecto");var useranswer=xmlDoc.createElement("useranswer");useranswer.innerHTML=mySel.selectedIndex;xmlDoc.getElementById("p004").appendChild(useranswer);} function corregirRadio(){var f=formElement;var escorrecta=[];for(i=0;i<f.radio1.length;i++){if(f.radio1[i].checked){var useranswer=xmlDoc.createElement("useranswer");useranswer.innerHTML=i+1;xmlDoc.getElementById("p005").appendChild(useranswer);escorrecta[i]=false;for(j=0;j<respuestasRadio.length;j++){if(i==respuestasRadio[j]){escorrecta[i]=true;}} if(escorrecta[i]){nota+=1.0/respuestasRadio.length;darRespuestaHtml("P5: "+i+" correcta");}else{nota-=1.0/respuestasRadio.length;darRespuestaHtml("P5: "+i+" incorrecta");}}}} function corregirTexto2(){var s1=formElement.elements[3].value;if(s1==respuestaText2){darRespuestaHtml("P6: Exacto!");nota+=1;} else darRespuestaHtml("P6: Respuesta equivocada");} function corregirSelect2(){var sel2=formElement.elements[4];if(sel2.selectedIndex==respuestaSelect2){darRespuestaHtml("P7: Correcto");nota+=1;} else darRespuestaHtml("P7: Incorrecto");} function corregirCheckbox2(){var f=formElement;var escorrecta=[];for(i=0;i<f.color.length;i++){if(f.color[i].checked){escorrecta[i]=false;for(j=0;j<respuestasCheckbox2.length;j++){if(i==respuestasCheckbox2[j])escorrecta[i]=true;}}} for(i=0;i<f.color.length;i++){if(f.color[i].checked){if(escorrecta[i]){nota+=1.0/respuestasCheckbox2.length;darRespuestaHtml("P8: "+i+" correcta");nota+=1;}else{nota-=1.0/respuestasCheckbox2.length;darRespuestaHtml("P8: "+i+" incorrecta");}}}} function corregirMultiple2(){var mySel2=formElement.elements[5];if(mySel2.selectedIndex==respuestasMultiple2){darRespuestaHtml("P9: Correcto");nota+=1;} else darRespuestaHtml("P9: Incorrecto");} function corregirRadio2(){var f=formElement;var escorrecta=[];for(i=0;i<f.radio2.length;i++){if(f.radio2[i].checked){var useranswer=xmlDoc.createElement("useranswer");useranswer.innerHTML=i+1;xmlDoc.getElementById("p010").appendChild(useranswer);escorrecta[i]=false;for(j=0;j<respuestasRadio2.length;j++){if(i==respuestasRadio2[j])escorrecta[i]=true;} if(escorrecta[i]){nota+=1.0/respuestasRadio2.length;darRespuestaHtml("P10: "+i+" correcta");}else{nota-=1.0/respuestasRadio2.length;darRespuestaHtml("P10: "+i+" incorrecta");}}}} function ponerDatosInputHtml(t){document.getElementById("tituloInput").innerHTML=t;} function ponerDatosSelectHtml(t,nodes){document.getElementById("tituloSelect").innerHTML=t;var select=document.getElementsByTagName("select")[0];var result=nodes.iterateNext();i=0;while(result){var option=document.createElement("option");option.text=result.innerHTML;option.value=i+1;i++;select.options.add(option);result=nodes.iterateNext();}} function ponerDatosCheckboxHtml(t,nodes){var checkboxContainer=document.getElementById('checkboxDiv');document.getElementById('tituloCheckbox').innerHTML=t;var result=nodes.iterateNext();i=0;while(result){var input=document.createElement("input");var label=document.createElement("label");label.innerHTML=result.innerHTML;label.setAttribute("for","color_"+i);input.type="checkbox";input.name="color";input.id="color_"+i;i++;checkboxContainer.appendChild(input);checkboxContainer.appendChild(label);checkboxContainer.appendChild(document.createElement("br"));result=nodes.iterateNext();}} function ponerDatosMultipleHtml(t,nodes){document.getElementById("tituloMultiple").innerHTML=t;var mSelect=document.getElementsByTagName("select")[1];var result=nodes.iterateNext();i=0;while(result){var option=document.createElement("option");option.text=result.innerHTML;option.value=i+1;i++;mSelect.options.add(option);result=nodes.iterateNext();}} function ponerDatosradio(t,nodes){var radioContainer=document.getElementById('tituloRadio');var h3=document.createElement("h3");h3.innerHTML=t;radioContainer.appendChild(h3);var result=nodes.iterateNext();i=0;while(result){var input=document.createElement("input");var label=document.createElement("label");label.innerHTML=result.innerHTML;label.setAttribute("for","radio1_"+i);input.type="radio";input.name="radio1";input.id="radio1_"+i;i++;radioContainer.appendChild(input);radioContainer.appendChild(label);radioContainer.appendChild(document.createElement("br"));result=nodes.iterateNext();}} function ponerDatosInputHtml2(t){document.getElementById("tituloInput2").innerHTML=t;} function ponerDatosSelectHtml2(t,nodes){document.getElementById("tituloSelect2").innerHTML=t;var select=document.getElementsByTagName("select")[2];var result=nodes.iterateNext();i=0;while(result){var option=document.createElement("option");option.text=result.innerHTML;option.value=i+1;i++;select.options.add(option);result=nodes.iterateNext();}} function ponerDatosCheckboxHtml2(t,nodes){var checkboxContainer2=document.getElementById('checkboxDiv2');document.getElementById('tituloCheckbox2').innerHTML=t;var result=nodes.iterateNext();i=0;while(result){var input=document.createElement("input");var label=document.createElement("label");label.innerHTML=result.innerHTML;label.setAttribute("for","color_"+i);input.type="checkbox";input.name="color";input.id="color_"+i;i++;checkboxContainer2.appendChild(input);checkboxContainer2.appendChild(label);checkboxContainer2.appendChild(document.createElement("br"));result=nodes.iterateNext();}} function ponerDatosMultipleHtml2(t,nodes){document.getElementById("tituloMultiple2").innerHTML=t;var mSelect=document.getElementsByTagName("select")[3];var result=nodes.iterateNext();i=0;while(result){var option=document.createElement("option");option.text=result.innerHTML;option.value=i+1;i++;mSelect.options.add(option);result=nodes.iterateNext();}} function ponerDatosradio2(t,nodes){var radioContainer2=document.getElementById('tituloRadio2');var h3=document.createElement("h3");h3.innerHTML=t;radioContainer2.appendChild(h3);var result=nodes.iterateNext();i=0;while(result){var input=document.createElement("input");var label=document.createElement("label");label.innerHTML=result.innerHTML;label.setAttribute("for","radio2_"+i);input.type="radio";input.name="radio2";input.id="radio2_"+i;i++;radioContainer2.appendChild(input);radioContainer2.appendChild(label);radioContainer2.appendChild(document.createElement("br"));result=nodes.iterateNext();}} function darRespuestaHtml(r){var p=document.createElement("p");p.innerHTML=r;document.body.appendChild(p);} function presentarNota(){document.body.innerHTML="";document.body.style.display="block";if(document.implementation&&document.implementation.createDocument){xsltProcessor=new XSLTProcessor();xsltProcessor.importStylesheet(xslDoc);resultDocument=xsltProcessor.transformToFragment(xmlDoc,document);document.body.appendChild(resultDocument);} darRespuestaHtml("<h3>Nota: "+nota+" puntos sobre 10</h3>");document.getElementById("h1").focus();} function comprobar(){var f=formElement;var checked=false;var checked2=false;var radioChecked=false;var radioChecked2=false;for(i=0;i<f.color.length;i++){if(f.color[i].checked)checked=true;} for(i=0;i<f.color.length;i++){if(f.color[i].checked)checked2=true;} for(i=0;i<f.radio1.length;i++){if(f.radio1[i].checked)radioChecked=true;} for(i=0;i<f.radio2.length;i++){if(f.radio2[i].checked)radioChecked2=true;} if(document.getElementById("text1").value==""){document.getElementById("text1").focus();alert("Debes rellenar la pregunta 1");return false;}else if(document.getElementById("sel").selectedIndex==0){document.getElementById("sel").focus();alert("Selecciona una opción en la pregunta 2");return false;}else if(!checked){document.getElementById("tituloCheckbox").scrollIntoView();alert("Selecciona una opción en la pregunta 3");return false;}else if(document.getElementById("mySel").selectedIndex==-1){alert("Selecciona una opción en la pregunta 4");document.getElementById("tituloMultiple").scrollIntoView();return false;}else if(!radioChecked){document.getElementById("tituloRadio").scrollIntoView();alert("Selecciona una opción en la pregunta 5");return false;}else if(document.getElementById("num2").value==""){document.getElementById("num2").focus();alert("Debes rellenar la pregunta 6");return false;}else if(document.getElementById("sel2").selectedIndex==0){document.getElementById("sel2").focus();alert("Selecciona una opción en la pregunta 7");return false;}else if(!checked2){document.getElementById("tituloCheckbox2").scrollIntoView();alert("Selecciona una opción en la pregunta 8");return false;}else if(document.getElementById("mySel2").selectedIndex==-1){alert("Selecciona una opción en la pregunta 9");document.getElementById("tituloMultiple2").scrollIntoView();return false;}else if(!radioChecked2){document.getElementById("tituloRadio2").scrollIntoView();alert("Selecciona una opción en la pregunta 10");return false;} else return true;}